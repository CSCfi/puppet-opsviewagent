#!/bin/bash

# Managed by puppet

# This script will check hwclock of the node.
# Then compare hwclock with system time.
# If hwclock is not same with system clock then 
# it will return WARNING. If hwclock is same with
# system clock then it will return OK.

# Nagios return codes
OK=0
WARNING=1
CRITICAL=2
UNKNOWN=3

HWtime=$(sudo hwclock --debug | grep Hw | cut -d" " -f 8)
SYStime=$(date +%s)
let diff_time=$SYStime-$HWtime

if [ $diff_time -gt 1 ] ; then
   echo "WARNING: hwclock is $diff_time seconds past of system time"
   exit $WARNING

elif [ $diff_time -eq 0 ] ; then
   echo "OK: Hardware clock is synced with system time"
   exit $OK

else 
   echo "Hardware clock is now ahead of system time"
   exit $UNKNOWN
fi
